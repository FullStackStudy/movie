<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <title>ğŸ¥MovieFlex</title>
    <style>
        /* ì£¼ë¬¸ ë‚´ì—­ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .order-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .order-table .table {
            margin-bottom: 0;
        }
        
        .order-table .table thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            border: none;
            padding: 1rem 0.75rem;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .order-table .table tbody td {
            border: none;
            border-bottom: 1px solid #f8f9fa;
            padding: 1rem 0.75rem;
            vertical-align: middle;
            font-size: 0.9rem;
        }
        
        .order-table .table tbody tr:hover {
            background-color: #f8f9fa;
            transition: background-color 0.3s ease;
        }
        
        .order-table .table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* ì£¼ë¬¸ë‚´ì—­ í…Œì´ë¸” ì…€ ìŠ¤íƒ€ì¼ í†µì¼ */
        .order-table .table tbody td {
            border: none;
            border-bottom: 1px solid #f8f9fa;
            padding: 1rem 0.75rem;
            vertical-align: middle;
            font-size: 0.9rem;
            color: #000000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }
        
        /* ì£¼ë¬¸ë²ˆí˜¸ ìŠ¤íƒ€ì¼ */
        .order-number {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            color: #000000;
            background: #f8f9fa;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
            display: inline-block;
        }
        
        /* ì˜í™”ì œëª© ìŠ¤íƒ€ì¼ */
        .movie-title {
            font-weight: 600;
            color: #000000;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
            display: inline-block;
        }
        
        /* ì˜í™”ê´€ ìŠ¤íƒ€ì¼ */
        .cinema-name {
            color: #000000;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
            display: inline-block;
        }
        
        /* ì˜ˆë§¤ìˆ˜ ìŠ¤íƒ€ì¼ */
        .ticket-count {
            background: #28a745;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
            min-width: 40px;
            white-space: nowrap;
        }
        
        /* ì¢Œì„ ìŠ¤íƒ€ì¼ */
        .seat-info {
            background: #e9ecef;
            color: #000000;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
            display: inline-block;
        }
        
        /* ê²°ì œê¸ˆì•¡ ìŠ¤íƒ€ì¼ */
        .payment-amount {
            font-weight: 700;
            color: #000000;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        /* ê²°ì œìˆ˜ë‹¨ ìŠ¤íƒ€ì¼ */
        .payment-method {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
            min-width: 60px;
            white-space: nowrap;
        }
        
        .payment-method.kakao {
            background: #fee500;
            color: #3c1e1e;
        }
        
        .payment-method.card {
            background: #007bff;
            color: white;
        }
        
        .payment-method.point {
            background: #28a745;
            color: white;
        }
        
        /* ê²°ì œì¼ì‹œ ìŠ¤íƒ€ì¼ */
        .payment-date {
            color: #000000;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        /* ë¹ˆ ì£¼ë¬¸ ë‚´ì—­ ìŠ¤íƒ€ì¼ */
        .empty-orders {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }
        
        .empty-orders i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .order-table {
                font-size: 0.8rem;
            }
            
            .order-table .table thead th,
            .order-table .table tbody td {
                padding: 0.5rem 0.25rem;
                font-size: 0.75rem;
            }
            
            .movie-title,
            .seat-info {
                max-width: 80px;
            }
            
            .order-number {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<div layout:fragment="content">
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <h2 class="mb-4 text-center">ë§ˆì´í˜ì´ì§€</h2>

                <div th:if="${message}" class="alert alert-success" role="alert">
                    <p th:text="${message}"></p>
                </div>

                <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                    <p th:text="${errorMessage}"></p>
                </div>

                <div th:if="${myPageDto}" class="card">
                    <div class="card-body">
                        <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¹ì…˜ -->
                        <div class="text-center mb-4">
                            <img th:src="${myPageDto.profile != null and myPageDto.profile != '' ? myPageDto.profile : '/images/default-profile.png'}"
                                 alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
                                 class="rounded-circle"
                                 style="width: 120px; height: 120px; object-fit: cover; border: 3px solid #007bff;"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRkZGRkZGIi8+CjxjaXJjbGUgY3g9IjYwIiBjeT0iNDgiIHI9IjE2IiBmaWxsPSIjQ0NDIi8+CjxyZWN0IHg9IjI0IiB5PSI3MiIgd2lkdGg9IjcyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjQ0NDIi8+Cjwvc3ZnPgo='">
                            <h4 class="mt-3" th:text="${myPageDto.name}"></h4>
                            <p class="text-muted" th:text="${'@' + myPageDto.nickname}"></p>
                        </div>

                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <h5 class="card-title mb-3">ê¸°ë³¸ ì •ë³´</h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">ì•„ì´ë”” (ì´ë©”ì¼)</label>
                                <input type="text" class="form-control" th:value="${myPageDto.memberId}" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ë‹‰ë„¤ì„</label>
                                <input type="text" class="form-control" th:value="${myPageDto.nickname}" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">ì´ë¦„</label>
                                <input type="text" class="form-control" th:value="${myPageDto.name}" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ìƒë…„ì›”ì¼</label>
                                <input type="text" class="form-control"
                                       th:value="${#temporals.format(myPageDto.birth, 'yyyy-MM-dd')}" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">íœ´ëŒ€í°</label>
                                <input type="text" class="form-control" th:value="${myPageDto.phone}" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ì£¼ì†Œ</label>
                                <input type="text" class="form-control" th:value="${myPageDto.address}" readonly>
                            </div>
                        </div>

                        <!-- íšŒì› ì •ë³´ -->
                        <h5 class="card-title mb-3 mt-4">íšŒì› ì •ë³´</h5>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">íšŒì› ë“±ê¸‰</label>
                                <input type="text" class="form-control" th:value="${myPageDto.grade}" readonly>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">ê°€ì…ì¼</label>
                                <input type="text" class="form-control"
                                       th:value="${#temporals.format(myPageDto.regDate, 'yyyy-MM-dd')}" readonly>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">í¬ì¸íŠ¸</label>
                                <input type="text" class="form-control"
                                       th:value="${myPageDto.point != null ? myPageDto.point : '0'}" readonly>
                            </div>
                        </div>


                        <!-- ì£¼ë¬¸ ë‚´ì—­ -->
                        <h5 class="card-title mb-3 mt-4">ğŸ“‹ ì£¼ë¬¸ ë‚´ì—­</h5>
                        <div th:if="${orderList != null and !orderList.empty}" class="order-table">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                                        <th>ì˜í™”ì œëª©</th>
                                        <th>ì˜í™”ê´€</th>
                                        <th>ì˜ˆë§¤ìˆ˜</th>
                                        <th>ì¢Œì„</th>
                                        <th>ê²°ì œê¸ˆì•¡</th>
                                        <th>ê²°ì œìˆ˜ë‹¨</th>
                                        <th>ê²°ì œì¼ì‹œ</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="order : ${orderList}">
                                        <td>
                                            <span class="order-number" th:text="${order.orderNumber}"></span>
                                        </td>
                                        <td>
                                            <div class="movie-title" th:text="${order.movieTitle}"></div>
                                        </td>
                                        <td>
                                            <div class="cinema-name" th:text="${order.cinemaName}"></div>
                                        </td>
                                        <td>
                                            <span class="ticket-count" th:text="${order.per != null ? order.per + 'ë§¤' : '1ë§¤'}"></span>
                                        </td>
                                        <td>
                                            <div class="seat-info" th:text="${order.seat}"></div>
                                        </td>
                                        <td>
                                            <span class="payment-amount" th:text="${order.paymentAmount} + 'ì›'"></span>
                                        </td>
                                        <td>
                                            <span th:class="${'payment-method ' + (order.paymentMethod == 'KAKAO_PAY' ? 'kakao' : (order.paymentMethod == 'CARD' ? 'card' : 'point'))}" 
                                                  th:text="${order.paymentMethod == 'KAKAO_PAY' ? 'ì¹´ì¹´ì˜¤í˜ì´' : (order.paymentMethod == 'CARD' ? 'ì¹´ë“œ' : 'í¬ì¸íŠ¸')}"></span>
                                        </td>
                                        <td>
                                            <div class="payment-date" th:text="${#temporals.format(order.paymentDate, 'yyyy-MM-dd HH:mm')}"></div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div th:if="${orderList == null or orderList.empty}" class="empty-orders">
                            <i class="fas fa-ticket-alt">ğŸ«</i>
                            <p>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <small class="text-muted">ì˜í™”ë¥¼ ì˜ˆë§¤í•˜ì‹œë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</small>
                        </div>


                        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                        <div class="d-grid gap-2 mt-4">
                            <a href="/mypage/storeOrders" class="btn btn-primary btn-lg">ìŠ¤í† ì–´ ì£¼ë¬¸ ë‚´ì—­</a>
                            <a href="/mypage/edit" class="btn btn-primary btn-lg">íšŒì›ì •ë³´ ìˆ˜ì •</a>
                            <a href="/mypage/change-password" class="btn btn-secondary btn-lg">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
                            <a href="/" class="btn btn-outline-secondary btn-lg">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</html> 